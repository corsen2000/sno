#!/usr/bin/env ruby
#require "rubygems"
#require "bundler/setup"
SNO_ROOT =  File.expand_path("../../", __FILE__)
TEMPLATE_ROOT = "#{SNO_ROOT}/assets/templates"
require "sno"
require 'optparse'
require "json"

include Sno

options = {
    :project_name => nil,
    :force => false
}

OptionParser.new do |opts|
	opts.banner = "Usage: sno.rb input_dir [output_dir] [options]"

	opts.on("-n", "--project-name [NAME]", String, "Specify a name to persist throughout the pages") do |n|
    	options[:project_name] = n
  	end

  	opts.on("-f", "--force", "Force updates to .sno assets directory") do
  		options[:force] = true
  	end

  	opts.on("-h", "--help", "Show this message") do
    	puts opts
    exit
  end
end.parse!

input_dir = (ARGV[0] && ARGV[0].chomp("/")) or raise "You must specify a input directory!"
output_dir = (ARGV[1] && ARGV[1].chomp("/")) || "#{input_dir}/SnoOut"

root_extractor, assets_root = sno_init(input_dir, output_dir, options)
root_extractor.save

File.open("#{assets_root}/search_index.json", "w+") do |f|
	f.puts JSON(Page.pages)
end